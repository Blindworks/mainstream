<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="005-insert-competitions" author="claude" context="test-data">
        <preConditions onFail="MARK_RAN" onError="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM competitions WHERE title = 'Frankfurt 5K Challenge'
            </sqlCheck>
        </preConditions>

        <comment>Insert sample competitions and challenges</comment>

        <sql>
            -- Active Competition 1: Frankfurt 5K Challenge
            INSERT INTO competitions (
                title, description, type, status, difficulty,
                start_date, end_date, prize_description, rules, max_participants,
                icon_url, created_by, created_at, updated_at
            ) VALUES
            ('Frankfurt 5K Challenge',
             'Laufe die schnellste 5K Zeit in diesem Monat! Messe dich mit anderen Läufern aus Frankfurt.',
             'FASTEST_5K', 'ACTIVE', 'INTERMEDIATE',
             DATE_SUB(NOW(), INTERVAL 5 DAY), DATE_ADD(NOW(), INTERVAL 25 DAY),
             'Ehrenmeldung auf der Plattform',
             'Es zählt nur der schnellste 5K Lauf während des Wettbewerbszeitraums. GPS-Tracking erforderlich.',
             100, NULL,
             (SELECT id FROM users WHERE email = 'admin@mainstream.app'),
             NOW(), NOW());

            -- Active Competition 2: Main-Ufer Distance Race
            INSERT INTO competitions (
                title, description, type, status, difficulty,
                start_date, end_date, prize_description, rules, max_participants,
                icon_url, created_by, created_at, updated_at
            ) VALUES
            ('Main-Ufer Distance Race',
             'Wer läuft die meisten Kilometer am Mainufer? Alle Routen am Main zählen!',
             'MOST_DISTANCE', 'ACTIVE', 'BEGINNER',
             DATE_SUB(NOW(), INTERVAL 10 DAY), DATE_ADD(NOW(), INTERVAL 20 DAY),
             NULL,
             'Alle Läufe auf den Main-Ufer Routen zählen zur Gesamtdistanz. Der Läufer mit der höchsten Gesamtdistanz gewinnt.',
             200, NULL,
             (SELECT id FROM users WHERE email = 'admin@mainstream.app'),
             NOW(), NOW());

            -- Active Competition 3: 30-Day Consistency Challenge
            INSERT INTO competitions (
                title, description, type, status, difficulty,
                start_date, end_date, prize_description, rules, max_participants,
                icon_url, created_by, created_at, updated_at
            ) VALUES
            ('30-Tage Konsistenz Challenge',
             'Laufe jeden Tag im Monat mindestens 2 Kilometer. Schaffe 30 Tage in Folge!',
             'CONSISTENCY_CHALLENGE', 'ACTIVE', 'INTERMEDIATE',
             DATE_SUB(NOW(), INTERVAL 7 DAY), DATE_ADD(NOW(), INTERVAL 23 DAY),
             'Spezielle Trophäe',
             'Mindestens 2km pro Tag. Kein Tag darf ausgelassen werden. Wer alle 30 Tage schafft, gewinnt.',
             50, NULL,
             (SELECT id FROM users WHERE email = 'admin@mainstream.app'),
             NOW(), NOW());

            -- Upcoming Competition: Ostpark 10K Speed Run
            INSERT INTO competitions (
                title, description, type, status, difficulty,
                start_date, end_date, prize_description, rules, max_participants,
                icon_url, created_by, created_at, updated_at
            ) VALUES
            ('Ostpark 10K Speed Run',
             'Schnellster 10K Lauf im Ostpark. Perfekte flache Strecke für persönliche Bestzeiten!',
             'FASTEST_10K', 'UPCOMING', 'INTERMEDIATE',
             DATE_ADD(NOW(), INTERVAL 5 DAY), DATE_ADD(NOW(), INTERVAL 35 DAY),
             NULL,
             'Es zählt nur der schnellste 10K Lauf auf der Ostpark Route während des Wettbewerbszeitraums.',
             75, NULL,
             (SELECT id FROM users WHERE email = 'admin@mainstream.app'),
             NOW(), NOW());

            -- Completed Competition: Winter Marathon Challenge
            INSERT INTO competitions (
                title, description, type, status, difficulty,
                start_date, end_date, prize_description, rules, max_participants,
                icon_url, created_by, created_at, updated_at
            ) VALUES
            ('Winter Marathon Challenge',
             'Laufe im Winter einen Marathon oder sammle die Marathon-Distanz über mehrere Läufe.',
             'MOST_DISTANCE', 'COMPLETED', 'ELITE',
             DATE_SUB(NOW(), INTERVAL 60 DAY), DATE_SUB(NOW(), INTERVAL 5 DAY),
             NULL,
             'Gesamtdistanz von mindestens 42.2 km während des Wettbewerbszeitraums. Alle Läufe zählen.',
             30, NULL,
             (SELECT id FROM users WHERE email = 'admin@mainstream.app'),
             DATE_SUB(NOW(), INTERVAL 60 DAY), DATE_SUB(NOW(), INTERVAL 5 DAY));
        </sql>

        <rollback>
            <sql>
                DELETE FROM competitions
                WHERE title IN ('Frankfurt 5K Challenge', 'Main-Ufer Distance Race', '30-Tage Konsistenz Challenge',
                'Ostpark 10K Speed Run', 'Winter Marathon Challenge');
            </sql>
        </rollback>
    </changeSet>

</databaseChangeLog>
