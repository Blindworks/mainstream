<div class="run-rounds-trophies-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="30"></mat-spinner>
  </div>

  <!-- No Run Selected -->
  <div *ngIf="!runId && !activityId && !isLoading" class="no-selection">
    <p>Wählen Sie einen Lauf aus, um Runden und Trophäen anzuzeigen.</p>
  </div>

  <!-- Collapsable Accordion for Rounds & Trophies -->
  <mat-accordion *ngIf="(runId || activityId) && !isLoading" class="main-accordion">

    <!-- Trophies Expansion Panel - PROMINENTLY PLACED FIRST -->
    <mat-expansion-panel class="trophies-panel" [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>emoji_events</mat-icon>
          <span class="panel-title-text">Errungene Trophäen</span>
          <span class="badge" *ngIf="trophies.length > 0">{{ trophies.length }}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div *ngIf="trophies.length === 0" class="no-data">
        <mat-icon>info</mat-icon>
        <p>Keine Trophäen mit diesem Lauf erhalten</p>
      </div>

      <div class="trophies-list" *ngIf="trophies.length > 0">
        <div class="trophy-item" *ngFor="let userTrophy of trophies">
          <div class="trophy-icon" [style.background-color]="getTrophyCategoryColor(userTrophy.trophy.category)">
            <mat-icon>emoji_events</mat-icon>
          </div>
          <div class="trophy-info">
            <h4 class="trophy-name">{{ userTrophy.trophy.name }}</h4>
            <p class="trophy-description">{{ userTrophy.trophy.description }}</p>
            <div class="trophy-meta">
              <mat-chip class="category-chip" [style.background-color]="getTrophyCategoryColor(userTrophy.trophy.category)">
                {{ userTrophy.trophy.category }}
              </mat-chip>
            </div>
          </div>
        </div>
      </div>
    </mat-expansion-panel>

    <!-- Rounds/Laps Expansion Panel -->
    <mat-expansion-panel class="rounds-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>directions_run</mat-icon>
          <span class="panel-title-text">Runden</span>
          <span class="badge" *ngIf="laps.length > 0">{{ laps.length }}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div *ngIf="laps.length === 0" class="no-data">
        <mat-icon>info</mat-icon>
        <p>Keine Rundendaten verfügbar</p>
      </div>

      <mat-accordion *ngIf="laps.length > 0" class="laps-accordion">
        <mat-expansion-panel *ngFor="let lap of laps">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <span class="lap-number">Runde {{ lap.lapNumber }}</span>
              <span class="lap-distance">{{ formatDistance(lap.distanceKm) }}</span>
              <span class="lap-time">{{ lap.formattedDuration }}</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="lap-details">
            <div class="lap-stat" *ngIf="lap.avgPace">
              <span class="stat-label">Ø Tempo:</span>
              <span class="stat-value">{{ lap.avgPace }}</span>
            </div>
            <div class="lap-stat" *ngIf="lap.avgSpeedKmh">
              <span class="stat-label">Ø Geschwindigkeit:</span>
              <span class="stat-value">{{ lap.avgSpeedKmh.toFixed(1) }} km/h</span>
            </div>
            <div class="lap-stat" *ngIf="lap.avgHeartRate">
              <span class="stat-label">Ø Herzfrequenz:</span>
              <span class="stat-value">{{ lap.avgHeartRate }} bpm</span>
            </div>
            <div class="lap-stat" *ngIf="lap.avgCadence">
              <span class="stat-label">Ø Kadenz:</span>
              <span class="stat-value">{{ lap.avgCadence }} spm</span>
            </div>
            <div class="lap-stat" *ngIf="lap.totalCalories">
              <span class="stat-label">Kalorien:</span>
              <span class="stat-value">{{ lap.totalCalories }} kcal</span>
            </div>
            <div class="lap-stat" *ngIf="lap.totalAscent">
              <span class="stat-label">Aufstieg:</span>
              <span class="stat-value">{{ lap.totalAscent }} m</span>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-expansion-panel>

  </mat-accordion>
</div>
