<div class="password-reset-container">
  <div class="password-reset-wrapper">
    <!-- Branding Section -->
    <div class="branding">
      <div class="brand-icon">
        <mat-icon>waves</mat-icon>
      </div>
      <h1 class="brand-title">Mainstream</h1>
    </div>

    <!-- Password Reset Card -->
    <mat-card class="password-reset-card">
      <!-- Request Mode: Email Input -->
      @if (!isResetMode() && !emailSent()) {
        <mat-card-header class="card-header">
          <mat-card-title class="card-title">{{ 'auth.passwordReset.title' | transloco }}</mat-card-title>
          <mat-card-subtitle class="card-subtitle">{{ 'auth.passwordReset.subtitle' | transloco }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content class="card-content">
          <form [formGroup]="requestForm" (ngSubmit)="onRequestSubmit()" class="password-reset-form">

            <!-- Email Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'auth.passwordReset.email' | transloco }}</mat-label>
              <input
                matInput
                type="email"
                formControlName="email"
                required
                [attr.aria-label]="'auth.passwordReset.email' | transloco"
                autocomplete="email">
              <mat-icon matSuffix aria-hidden="true">email</mat-icon>
              @if (requestForm.get('email')?.hasError('required') && requestForm.get('email')?.touched) {
                <mat-error>{{ 'auth.passwordReset.emailRequired' | transloco }}</mat-error>
              }
              @if (requestForm.get('email')?.hasError('email') && requestForm.get('email')?.touched) {
                <mat-error>{{ 'auth.passwordReset.emailInvalid' | transloco }}</mat-error>
              }
            </mat-form-field>

            <!-- Submit Button -->
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="requestForm.invalid || isSubmitting()"
              class="submit-button"
              [attr.aria-busy]="isSubmitting()">
              @if (isSubmitting()) {
                <mat-spinner diameter="20" class="submit-spinner" aria-hidden="true"></mat-spinner>
                <span>{{ 'auth.passwordReset.sending' | transloco }}</span>
              } @else {
                <span>{{ 'auth.passwordReset.sendResetLink' | transloco }}</span>
              }
            </button>

            <!-- Back to Login -->
            <div class="back-to-login">
              <button type="button" mat-button (click)="backToLogin()" class="link-button">
                <mat-icon aria-hidden="true">arrow_back</mat-icon>
                <span>{{ 'auth.passwordReset.backToLogin' | transloco }}</span>
              </button>
            </div>
          </form>
        </mat-card-content>
      }

      <!-- Email Sent Confirmation -->
      @if (emailSent() && !isResetMode()) {
        <mat-card-header class="card-header">
          <mat-card-title class="card-title">{{ 'auth.passwordReset.checkEmail' | transloco }}</mat-card-title>
        </mat-card-header>

        <mat-card-content class="card-content">
          <div class="success-message">
            <div class="success-icon">
              <mat-icon>mark_email_read</mat-icon>
            </div>
            <p class="success-text">{{ 'auth.passwordReset.emailSentMessage' | transloco }}</p>
            <p class="success-subtext">{{ 'auth.passwordReset.checkSpam' | transloco }}</p>

            <!-- Back to Login -->
            <div class="back-to-login-centered">
              <button mat-raised-button color="primary" (click)="backToLogin()" class="submit-button">
                <mat-icon aria-hidden="true">arrow_back</mat-icon>
                <span>{{ 'auth.passwordReset.backToLogin' | transloco }}</span>
              </button>
            </div>
          </div>
        </mat-card-content>
      }

      <!-- Reset Mode: New Password Input -->
      @if (isResetMode()) {
        <mat-card-header class="card-header">
          <mat-card-title class="card-title">{{ 'auth.passwordReset.resetTitle' | transloco }}</mat-card-title>
          <mat-card-subtitle class="card-subtitle">{{ 'auth.passwordReset.resetSubtitle' | transloco }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content class="card-content">
          <form [formGroup]="resetForm" (ngSubmit)="onResetSubmit()" class="password-reset-form">

            <!-- New Password Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'auth.passwordReset.newPassword' | transloco }}</mat-label>
              <input
                matInput
                [type]="hidePassword() ? 'password' : 'text'"
                formControlName="password"
                required
                [attr.aria-label]="'auth.passwordReset.newPassword' | transloco"
                autocomplete="new-password">
              <button
                type="button"
                mat-icon-button
                matSuffix
                (click)="togglePasswordVisibility()"
                [attr.aria-label]="hidePassword() ? 'Show password' : 'Hide password'"
                class="password-toggle">
                <mat-icon>{{hidePassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              @if (resetForm.get('password')?.hasError('required') && resetForm.get('password')?.touched) {
                <mat-error>{{ 'auth.passwordReset.passwordRequired' | transloco }}</mat-error>
              }
              @if (resetForm.get('password')?.hasError('minlength') && resetForm.get('password')?.touched) {
                <mat-error>{{ 'auth.passwordReset.passwordMinLength' | transloco }}</mat-error>
              }
            </mat-form-field>

            <!-- Confirm Password Field -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ 'auth.passwordReset.confirmPassword' | transloco }}</mat-label>
              <input
                matInput
                [type]="hideConfirmPassword() ? 'password' : 'text'"
                formControlName="confirmPassword"
                required
                [attr.aria-label]="'auth.passwordReset.confirmPassword' | transloco"
                autocomplete="new-password">
              <button
                type="button"
                mat-icon-button
                matSuffix
                (click)="toggleConfirmPasswordVisibility()"
                [attr.aria-label]="hideConfirmPassword() ? 'Show password' : 'Hide password'"
                class="password-toggle">
                <mat-icon>{{hideConfirmPassword() ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              @if (resetForm.get('confirmPassword')?.hasError('required') && resetForm.get('confirmPassword')?.touched) {
                <mat-error>{{ 'auth.passwordReset.confirmPasswordRequired' | transloco }}</mat-error>
              }
              @if (resetForm.hasError('passwordMismatch') && resetForm.get('confirmPassword')?.touched) {
                <mat-error>{{ 'auth.passwordReset.passwordMismatch' | transloco }}</mat-error>
              }
            </mat-form-field>

            <!-- Submit Button -->
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="resetForm.invalid || isSubmitting()"
              class="submit-button"
              [attr.aria-busy]="isSubmitting()">
              @if (isSubmitting()) {
                <mat-spinner diameter="20" class="submit-spinner" aria-hidden="true"></mat-spinner>
                <span>{{ 'auth.passwordReset.resetting' | transloco }}</span>
              } @else {
                <span>{{ 'auth.passwordReset.resetPassword' | transloco }}</span>
              }
            </button>

            <!-- Back to Login -->
            <div class="back-to-login">
              <button type="button" mat-button (click)="backToLogin()" class="link-button">
                <mat-icon aria-hidden="true">arrow_back</mat-icon>
                <span>{{ 'auth.passwordReset.backToLogin' | transloco }}</span>
              </button>
            </div>
          </form>
        </mat-card-content>
      }
    </mat-card>
  </div>
</div>
